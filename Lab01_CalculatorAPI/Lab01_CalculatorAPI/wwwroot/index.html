<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <title>數字計算器</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">

</head>

<body>

    <div class="container">
        <div class="calculator-container">
            <h1 class="text-center mb-4">🧮 數字計算器</h1>

            <!-- 輸入區域 -->
            <div class="row mb-3">
                <div class="col-md-6">
                    <label for="firstNumber" class="form-label">第一個數字</label>
                    <input type="number" class="form-control" id="firstNumber" step="0.01" placeholder="請輸入數字">
                </div>
                <div class="col-md-6">
                    <label for="secondNumber" class="form-label">第二個數字</label>
                    <input type="number" class="form-control" id="secondNumber" step="0.01" placeholder="請輸入數字">
                </div>
            </div>

            <!-- 按鈕區域 -->
            <div class="row mb-3">
                <div class="col-6 col-md-3 mb-2">
                    <button class="btn btn-primary w-100" onclick="calculate('add')">
                        ➕ 加法
                    </button>
                </div>
                <div class="col-6 col-md-3 mb-2">
                    <button class="btn btn-success w-100" onclick="calculate('subtract')">
                        ➖ 減法
                    </button>
                </div>
                <div class="col-6 col-md-3 mb-2">
                    <button class="btn btn-warning w-100" onclick="calculate('multiply')">
                        ✖️ 乘法
                    </button>
                </div>
                <div class="col-6 col-md-3 mb-2">
                    <button class="btn btn-danger w-100" onclick="calculate('divide')">
                        ➗ 除法
                    </button>
                </div>
            </div>

            <!-- Loading 狀態 -->
            <div class="loading text-center" style="display: none;">
                <div class="spinner-border text-primary" role="status">
                    <span class="visually-hidden">計算中...</span>
                </div>
                <p class="mt-2">計算中，請稍候...</p>
            </div>

            <!-- 結果顯示區域 -->
            <div class="result-section" id="resultSection" style="display: none;">
                <h4>計算結果：</h4>
                <div id="resultContent"></div>
            </div>
        </div>
    </div>

    <script>
        // 計算函數 - 使用 fetch API 呼叫後端
        async function calculate(operation) {
            // 取得輸入值
            const firstNumber = parseFloat(document.getElementById('firstNumber').value);
            const secondNumber = parseFloat(document.getElementById('secondNumber').value);

            // 驗證輸入
            if (isNaN(firstNumber) || isNaN(secondNumber)) {
                showError('請輸入有效的數字！');
                return;
            }

            // 顯示 loading 狀態
            showLoading(true);
            hideResult();

            try {
                // 準備請求資料
                const requestData = {
                    firstNumber: firstNumber,
                    secondNumber: secondNumber
                };

                // 用 JavaScript 的 fetch API 發送 HTTP 請求到後端

                // 使用非同步等待 await 發送 HTTP 請求
                const response = await fetch(`/api/calculator/${operation}`, {
                    // `/api/calculator/${operation}`：動態 URL，operation 變數會替換成實際運算（如 "add", "subtract"）
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                        // 告訴伺服器傳送的是 JSON 格式資料
                    },
                    body: JSON.stringify(requestData)
                    // 將 JavaScript 物件轉換成 JSON 字串放在請求 body 中
                });
                //   實際運作：
                //   當 operation 是 "add" 時，會發送 POST 請求到
                //   /api/calculator/add，這對應到 C# 控制器中的 Add 方法。



                // 解析回應
                const result = await response.json();

                if (result.success) {
                    showSuccess(result);
                } else {
                    showError(result.errorMessage);
                }

            } catch (error) {
                showError('網路錯誤或伺服器無回應：' + error.message);
            } finally {
                // 隱藏 loading 狀態
                showLoading(false);
            }
        }

        // 顯示成功結果
        function showSuccess(result) {
            const resultSection = document.getElementById('resultSection');
            const resultContent = document.getElementById('resultContent');

            resultContent.innerHTML = `
                    <div class="success">
                        <h5>✅ ${result.operation}計算成功！</h5>
                        <p class="fs-4 mb-0">
                            <strong>結果：${result.result}</strong>
                        </p>
                    </div>
                `;

            resultSection.style.display = 'block';
        }

        // 顯示錯誤訊息
        function showError(message) {
            const resultSection = document.getElementById('resultSection');
            const resultContent = document.getElementById('resultContent');

            resultContent.innerHTML = `
                    <div class="error">
                        <h5>❌ 計算失敗</h5>
                        <p class="mb-0">${message}</p>
                    </div>
                `;

            resultSection.style.display = 'block';
        }

        // 顯示/隱藏 loading 狀態
        function showLoading(show) {
            const loading = document.querySelector('.loading');
            // querySelector 是 JavaScript DOM API 的方法，用來選取 HTML 元素，語法：document.querySelector('選擇器')
            loading.style.display = show ? 'block' : 'none';
        }

        // 隱藏結果
        function hideResult() {
            document.getElementById('resultSection').style.display = 'none';
        }

        // 按 Enter 鍵觸發加法計算
        document.addEventListener('keypress', function (event) {
            if (event.key === 'Enter') {
                calculate('add');
            }
        });
    </script>

</body>

</html>